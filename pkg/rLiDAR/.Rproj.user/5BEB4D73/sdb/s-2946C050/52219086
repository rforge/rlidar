{
    "contents" : "###--------------------------------------------------------------------------------------------------------###\n#----------------------------------------------------------------------------------------------------------###\n# SILVA, C. A. (2013)                                                                                      ###\n# Forester and Master's degree                                                                             ### \n# Ph.D Student at University of Idaho                                                                      ###\n# Rocky Mountain Reserach Station- RMRS                                                                    ###\n# US Forest Service - USDA                                                                                 ###\n# Moscow - Idaho                                                                                           ###\n# carlos_engflorestal@outlook.com.br                                                                       ###\n# Skype: flowds                                                                                            ###\n#----------------------------------------------------------------------------------------------------------###\n#----------------------------------------------------------------------------------------------------------###\n#           Individual tree detection - Ichauway_LiDAR - CJF 2014\n#----------------------------------------------------------------------------------------------------------###\n#----------------------------------------------------------------------------------------------------------###\n\n#----------------------------------------------------------------------------------------------------------###\n# 01 require packages\n#----------------------------------------------------------------------------------------------------------###\nrequire(maptools)\n\n#----------------------------------------------------------------------------------------------------------###\n# 02 clip CHM plot01\n#----------------------------------------------------------------------------------------------------------###\n\noutgrid1 = read.asciigrid(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\02_BigPlots\\\\CNT\\\\CNT_LASplots_4.asc\")\n\n# Packages necessary\nrequire(raster);require(sp);require(maptools);\n# Importing shapefile of the land\n# open the shapefile\nforest.shp1 <- readShapePoly('C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Gridbuffer\\\\grid50buffer2.shp')\n\n# clip the area of the interest\noutgrid_stand1 <- outgrid1[!is.na(overlay(outgrid1, forest.shp1)),]\n\n# save the map \n#writeAsciiGrid(outgrid_stand1,\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\Plot01_Stand.asc\")\n\n#----------------------------------------------------------------------------------------------------------###\n# 02 - Import shapefile for the Plot01 and plot the tree location\n#----------------------------------------------------------------------------------------------------------###\nFieldTrees1<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\FieldTrees.shp\")\nFieldTrees1<-as.data.frame(FieldTrees1)\nhead(FieldTrees1)\nnt_FieldTrees1<-nrow(FieldTrees1)\n\nLiDAR_all1<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\LiDAR_all.shp\")\nLiDAR_all1<-as.data.frame(LiDAR_all1)\nhead(LiDAR_all1)\nnt_LiDAR_all1<-nrow(LiDAR_all1)\n\nLiDAR_f1.1<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\LiDAR_4_f4.shp\")\nLiDAR_f1.1<-as.data.frame(LiDAR_f1.1)\nhead(LiDAR_f1.1)\nnt_LiDAR_f1.1<-nrow(LiDAR_f1.1)\n\nLiDAR_f2.1<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\LiDAR_4_f6.shp\")\nLiDAR_f2.1<-as.data.frame(LiDAR_f2.1)\nhead(LiDAR_f2.1)\nnt_LiDAR_f2.1<-nrow(LiDAR_f2.1)\n\nPlot01Class1<-c(rep(\"Field\",nt_FieldTrees1),rep(\"Flight 1-2\",nt_LiDAR_all1),\n               rep(\"Flight line 1\",nt_LiDAR_f1.1),rep(\"Flight line 2\",nt_LiDAR_f2.1))\n\npchList1<-c(rep(1,nt_FieldTrees1),rep(2,nt_LiDAR_all1),\n               rep(3,nt_LiDAR_f1.1),rep(4,nt_LiDAR_f2.1))\n\ncorList1<-c(rep(\"black\",nt_FieldTrees1),rep(\"blue\",nt_LiDAR_all1),\n           rep(\"yellow\",nt_LiDAR_f1.1),rep(\"red\",nt_LiDAR_f2.1))\n\nPlot01List1<-cbind(Plot01Class1,rbind(FieldTrees1[,c(\"x\",\"y\")],\n                  LiDAR_all1[,c(\"x\",\"y\")],\n                  LiDAR_f1.1[,c(\"x\",\"y\")],\n                  LiDAR_f2.1[,c(\"x\",\"y\")]))\n\nwindows()\npar(mfrow=c(1,2))\n#par(xpd=T, mar=par()$mar+c(5,0,0,0))\nplot(raster(outgrid_stand1),xlim=c(739892.5,739942.5), ylim=c(3459690,3459742),xlab=\"UTM Easthing\", ylab=\"UTM Northing\")\nplot(SpatialPoints(Plot01List1[,2:3]),add=T, col=corList1,pch=pchList1)\ngrid(, lwd = 2)\n\n#legend(locator(1),c(\"group A\", \"group B\"), pch = c(1,2), lty = c(1,2))\n\n#treeBuff <- readShapePoly('C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\buffer_FieldTree.shp')\n# visualization of the original ResponseV map\n#plot(treeBuff, add=T, border='black', bg='transparent', asp=1)\n\n# buffer\nsource(\"C:\\\\00_CFJ_paper\\\\00_Scripts\\\\11_bufferPoly.r\")\nb1.5.1=bufferPoly(LiDAR_all[,1:2],1.5)\nplot(b1.5.1, add=T,type=\"c\" ,border='blue', bg='transparent', asp=1)\n\n#*************************************************************************************************\n#----------------------------------------------------------------------------------------------------------###\n#----------------------------------------------------------------------------------------------------------###\n# 02 clip CHM plot02\n#----------------------------------------------------------------------------------------------------------###\n#----------------------------------------------------------------------------------------------------------###\n\noutgrid2 = read.asciigrid(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\02_BigPlots\\\\NE\\\\NE_LASplots_15.asc\")\n\n# Packages necessary\nrequire(raster);require(sp);require(maptools);\n# Importing shapefile of the land\n# open the shapefile\nforest.shp2 <- readShapePoly('C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Gridbuffer\\\\grid50buffer2.shp')\n\n# clip the area of the interest\noutgrid_stand2 <- outgrid2[!is.na(overlay(outgrid2, forest.shp2)),]\n\n# save the map \n#writeAsciiGrid(outgrid_stand2,\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot02\\\\Plot02_Stand.asc\")\n\n#----------------------------------------------------------------------------------------------------------###\n# 02 - Import shapefile for the Plot01 and plot the tree location\n#----------------------------------------------------------------------------------------------------------###\nFieldTrees2<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot02\\\\Field_trees.shp\")\nFieldTrees2<-as.data.frame(FieldTrees2)\nhead(FieldTrees2)\nnt_FieldTrees2<-nrow(FieldTrees2)\n\nLiDAR_all2<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot02\\\\LiDAR_all.shp\")\nLiDAR_all2<-as.data.frame(LiDAR_all2)\nhead(LiDAR_all2)\nnt_LiDAR_all2<-nrow(LiDAR_all2)\n\nLiDAR_f1.2<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot02\\\\LiDAR_15_f20.shp\")\nLiDAR_f1.2<-as.data.frame(LiDAR_f1.2)\nhead(LiDAR_f1.2)\nnt_LiDAR_f1.2<-nrow(LiDAR_f1.2)\n\nLiDAR_f2.2<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot02\\\\LiDAR_15_f18.shp\")\nLiDAR_f2.2<-as.data.frame(LiDAR_f2.2)\nhead(LiDAR_f2.2)\nnt_LiDAR_f2.2<-nrow(LiDAR_f2.2)\n\nPlot01Class2<-c(rep(\"Field\",nt_FieldTrees2),rep(\"Flight 1-2\",nt_LiDAR_all2),\n               rep(\"Flight line 1\",nt_LiDAR_f1.2),rep(\"Flight line 2\",nt_LiDAR_f2.2))\n\npchList2<-c(rep(1,nt_FieldTrees2),rep(2,nt_LiDAR_all2),\n           rep(3,nt_LiDAR_f1.2),rep(4,nt_LiDAR_f2.2))\n\ncorList2<-c(rep(\"black\",nt_FieldTrees2),rep(\"blue\",nt_LiDAR_all2),\n           rep(\"yellow\",nt_LiDAR_f1.2),rep(\"red\",nt_LiDAR_f2.2))\n\nPlot01List2<-cbind(Plot01Class2,rbind(FieldTrees2[,c(\"x\",\"y\")],\n                                    LiDAR_all2[,c(\"x\",\"y\")],\n                                    LiDAR_f1.2[,c(\"x\",\"y\")],\n                                    LiDAR_f2.2[,c(\"x\",\"y\")]))\n\nplot(raster(outgrid_stand2),xlim=c(748034.8,748083), ylim=c(3459943,3459993),xlab=\"UTM Easthing\", ylab=\"UTM Northing\")\nplot(SpatialPoints(Plot01List2[,2:3]),add=T, col=corList2,pch=pchList2)\ngrid(, lwd = 2)\n\n#legend(locator(1),c(\"group A\", \"group B\"), pch = c(1,2), lty = c(1,2))\n\n#treeBuff <- readShapePoly('C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\plot02\\\\Field_tree_buff.shp')\n# visualization of the original ResponseV map\n#plot(treeBuff, add=T, border='black', bg='transparent', asp=1)\n  \n# buffer\nsource(\"C:\\\\00_CFJ_paper\\\\00_Scripts\\\\11_bufferPoly.r\")\nb1.5.2=bufferPoly(LiDAR_all[,1:2],1.5)\nplot(b1.5.2, add=T,type=\"c\" ,border='blue', bg='transparent', asp=1)\nlegend(locator(1),c(\"Field\", \"LiDAR all\", \"LiDAR f1\", \"LiDAR f2\"), pch = c(1,2,3,4), col = c(\"black\",\"blue\",\"yellow\",\"red\"))\n\n\n##########################################################################\n#\n# 3d plot\n#\n##########################################################################\nrequire(rLiDAR)\n??rLiDAR\ninstall.packages(\"rLiDAR\", repos=\"http://R-Forge.R-project.org\")\nrequire(rLiDAR)\n\nmyColorRamp <- function(colors, values) {\n  v <- (values - min(values))/diff(range(values))\n  x <- colorRamp(colors)(v)\n  rgb(x[,1], x[,2], x[,3], maxColorValue = 255)\n}\n\n# Plot 01 - 3d field \nALS1<-readLAS(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\GridLASplots_208.las\",short=TRUE)\nxals<-ALS1[,1]-range(ALS1[,1])[1]\nyals<-ALS1[,2]-range(ALS1[,2])[1]\nALScolorpallet <- myColorRamp(c(\"blue\",\"green\",\"yellow\",\"red\"),ALS1[,3])\nopen3d()\nplot3d(cbind(xals,yals,ALS1[,3]), col=ALScolorpallet, axes=FALSE, xlab = \"\", ylab = \"\",zlab = \"\", zlim=range(ALS1[,3]))\naxes3d(c(\"x+\", \"y-\",\"z\"), col=\"black\")\ngrid3d(side=c('x+', 'y-', 'z'), col=\"gray\")\ntitle3d(xlab = \"X\", ylab = \"\",zlab = \"\", col=\"black\", lwd=2)\naspect3d(1,1,30/50)\n\nxl<-FieldTrees1[,1]-range(FieldTrees1[,1])[1]\nyl<-FieldTrees1[,2]-range(FieldTrees1[,2])[1]\nhead(FieldTrees1)\n# Plotting the stand\nfor( i in 1:nrow(FieldTrees1)){\n  LiDARtrees3D(crownshape = \"halfellipsoid\", CL = FieldTrees1[i,17]*0.6, CW = FieldTrees1[i,21]*2,\n               HCB =  (FieldTrees1[i,17])*0.4, X = xl[i]+1, Y = yl[i]+2, dbh = FieldTrees1[i,7]/50,\n               crowncolor = \"forestgreen\", stemcolor = \"chocolate4\",\n               resolution=\"high\")\n}\n\n## Plot 01 - 2d field\nplot3d(cbind(xals,yals,ALS1[,3]), col=ALScolorpallet, axes=FALSE,xlim=c(-2,52),ylim=c(-2,52), xlab = \"\", ylab = \"\",zlab = \"\", pch=\".\",zlim=range(ALS1[,3]))\naxes3d(c(\"x-\", \"y-\"), col=\"black\")\nrgl.viewpoint(,0,fov = 0, zoom = 1, scale = par3d(\"scale\"), \n              interactive = TRUE)\ngrid3d(side=c('z'))\nxl<-FieldTrees1[,1]-range(FieldTrees1[,1])[1]\nyl<-FieldTrees1[,2]-range(FieldTrees1[,2])[1]\nhead(FieldTrees1)\n# Plotting the stand\nfor( i in 1:nrow(FieldTrees1)){\n  LiDARtrees3D(crownshape = \"halfellipsoid\", CL = FieldTrees1[i,17]*0.6, CW = FieldTrees1[i,21]*2,\n               HCB =  (FieldTrees1[i,17])*0.4, X = xl[i], Y = yl[i], dbh = FieldTrees1[i,7]/50,\n               crowncolor = \"forestgreen\", stemcolor = \"chocolate4\",\n               resolution=\"high\")\n}\n\n## Plot 01 - 2d LiDAR\nplot3d(cbind(xals,yals,ALS1[,3]), col=ALScolorpallet, axes=FALSE, xlab = \"\", ylab = \"\",zlab = \"\", zlim=range(ALS1[,3]))\naxes3d(c(\"x+\", \"y-\",\"z\"), col=\"black\")\n#planes3d(a=0,b=0,c=-1,d=0.0001,color=\"gray\",alpha=1)\ngrid3d(side=c('x+', 'y-', 'z'),col=\"gray\")\ntitle3d(xlab = \"X\", ylab = \"\",zlab = \"\", col=\"black\", lwd=2)\naspect3d(1,1,30/50)\n\nxlLiDAR1<-LiDAR_all1[,1]-range(LiDAR_all1[,1])[1]\nylLiDAR1<-LiDAR_all1[,2]-range(LiDAR_all1[,2])[1]\nhead(LiDAR_all1)\n# Plotting the stand\nfor( i in 1:nrow(LiDAR_all1)){\n  LiDARtrees3D(crownshape = \"halfellipsoid\", CL = LiDAR_all1[i,6]*0.6, CW = LiDAR_all1[i,6]*0.3,\n               HCB =  (LiDAR_all1[i,6])*0.4, X = xlLiDAR1[i]+2, Y = ylLiDAR1[i]+2, dbh = LiDAR_all1[i,6]/40,\n               crowncolor = \"forestgreen\", stemcolor = \"chocolate4\",\n               resolution=\"high\")\n}\n\n\n##### plot2\nALS2<-readLAS(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot02\\\\GridLASplots_209.las\",short=TRUE)\nxals2<-ALS2[,1]-range(ALS2[,1])[1] \nyals2<-ALS2[,2]-range(ALS2[,2])[1]\nALScolorpallet2 <- myColorRamp(c(\"blue\",\"green\",\"yellow\",\"red\"),ALS2[,3])\nplot3d(cbind(xals2,yals2,ALS2[,3]), col=ALScolorpallet2, axes=FALSE, xlab = \"\", ylab = \"\",zlab = \"\", zlim=range(ALS1[,3]))\naxes3d(c(\"x+\", \"y-\",\"z\"), col=\"black\")\n#planes3d(a=0,b=0,c=-1,d=0.0001,color=\"gray\",alpha=1)\ngrid3d(side=c('x+', 'y-', 'z'),col=\"gray\")\ntitle3d(xlab = \"X\", ylab = \"\",zlab = \"\", col=\"black\", lwd=2)\naspect3d(1,1,0.8)\n\nxl2<-FieldTrees2[,1]-range(FieldTrees2[,1])[1]\nyl2<-FieldTrees2[,2]-range(FieldTrees2[,2])[1]\nhead(FieldTrees1)\n# Plotting the stand\nfor( i in 1:nrow(FieldTrees2)){\n  LiDARtrees3D(crownshape = \"halfellipsoid\", CL = FieldTrees2[i,17]*0.6, CW = FieldTrees2[i,21]*2,\n               HCB =  (FieldTrees2[i,17])*0.4, X = xl2[i] +1.5, Y = yl2[i] +0.5, dbh = FieldTrees2[i,7]/50,\n               crowncolor = \"forestgreen\", stemcolor = \"chocolate4\",\n               resolution=\"high\")\n}\n\n# Plot 2 - 3d LiDAR\n\nplot3d(cbind(xals2,yals2,ALS2[,3]), col=ALScolorpallet2, axes=FALSE, xlab = \"\", ylab = \"\",zlab = \"\", zlim=range(ALS1[,3]))\naxes3d(c(\"x+\", \"y-\",\"z\"), col=\"black\")\n#planes3d(a=0,b=0,c=-1,d=0.0001,color=\"gray\",alpha=1)\ngrid3d(side=c('x+', 'y-', 'z'),col=\"gray\")\ntitle3d(xlab = \"X\", ylab = \"\",zlab = \"\", col=\"black\", lwd=2)\naspect3d(1,1,0.8)\nxlLiDAR2.<-LiDAR_all2[,1]-range(LiDAR_all2[,1])[1] ;\nylLiDAR2.<-LiDAR_all2[,2]-range(LiDAR_all2[,2])[1] ;\nhead(LiDAR_all2)\n# Plotting the stand\nfor( i in 1:nrow(LiDAR_all2)){\n  LiDARtrees3D(crownshape = \"halfellipsoid\", CL = LiDAR_all2[i,6]*0.6, CW = LiDAR_all2[i,6]*0.4,\n               HCB =  (LiDAR_all2[i,6])*0.4, X = xlLiDAR2[i]+1.5, Y = ylLiDAR2.[i]+0.5, dbh = LiDAR_all2[i,6]/40,\n               crowncolor = \"forestgreen\", stemcolor = \"chocolate4\",\n               resolution=\"high\")\n}\n\n\n",
    "created" : 1421828703789.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "752510244",
    "id" : "52219086",
    "lastKnownWriteTime" : 1422230055,
    "path" : "C:/00_CFJ_paper/00_Scripts/plot_figure.r",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}