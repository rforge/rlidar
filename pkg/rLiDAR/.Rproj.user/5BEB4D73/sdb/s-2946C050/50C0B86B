{
    "contents" : "###--------------------------------------------------------------------------------------------------------###\n#----------------------------------------------------------------------------------------------------------###\n# SILVA, C. A. (2013)                                                                                      ###\n# Forester and Master's degree                                                                             ### \n# Ph.D Student at University of Idaho                                                                      ###\n# Rocky Mountain Reserach Station- RMRS                                                                    ###\n# US Forest Service - USDA                                                                                 ###\n# Moscow - Idaho                                                                                           ###\n# carlos_engflorestal@outlook.com.br                                                                       ###\n# Skype: flowds                                                                                            ###\n#----------------------------------------------------------------------------------------------------------###\n#----------------------------------------------------------------------------------------------------------###\n#           Individual tree detection - Ichauway_LiDAR - CJF 2014\n#----------------------------------------------------------------------------------------------------------###\n#----------------------------------------------------------------------------------------------------------###\n\n#----------------------------------------------------------------------------------------------------------###\n# 01 require packages\n#----------------------------------------------------------------------------------------------------------###\nrequire(maptools)\nrequire(GIStool)\n#----------------------------------------------------------------------------------------------------------###\n# 02 clip CHM plot01\n#----------------------------------------------------------------------------------------------------------###\n\noutgrid1 = read.asciigrid(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\02_BigPlots\\\\CNT\\\\CNT_LASplots_4.asc\")\n\n# Packages necessary\nrequire(raster);require(sp);require(maptools);\n# Importing shapefile of the land\n# open the shapefile\nforest.shp1 <- readShapePoly('C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Gridbuffer\\\\grid50buffer2.shp')\n\n# clip the area of the interest\noutgrid_stand1 <- outgrid[!is.na(overlay(outgrid, forest.shp1)),]\n\n# save the map \nwriteAsciiGrid(outgrid_stand,\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\Plot01_Stand.asc\")\n\n#----------------------------------------------------------------------------------------------------------###\n# 02 - Import shapefile for the Plot01 and plot the tree location\n#----------------------------------------------------------------------------------------------------------###\nFieldTrees1<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\FieldTrees.shp\")\nFieldTrees1<-as.data.frame(FieldTrees1)\nhead(FieldTrees1)\nnt_FieldTrees1<-nrow(FieldTrees1)\n\nLiDAR_all1<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\LiDAR_all.shp\")\nLiDAR_all1<-as.data.frame(LiDAR_all1)\nhead(LiDAR_all1)\nnt_LiDAR_all1<-nrow(LiDAR_all1)\n\nLiDAR_f1.1<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\LiDAR_4_f4.shp\")\nLiDAR_f1.1<-as.data.frame(LiDAR_f1.1)\nhead(LiDAR_f1.1)\nnt_LiDAR_f1.1<-nrow(LiDAR_f1.1)\n\nLiDAR_f2.1<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\LiDAR_4_f6.shp\")\nLiDAR_f2.1<-as.data.frame(LiDAR_f2.1)\nhead(LiDAR_f2.1)\nnt_LiDAR_f2.1<-nrow(LiDAR_f2.1)\n\nPlot01Class1<-c(rep(\"Field\",nt_FieldTrees1),rep(\"Flight 1-2\",nt_LiDAR_all1),\n               rep(\"Flight line 1\",nt_LiDAR_f1.1),rep(\"Flight line 2\",nt_LiDAR_f2.1))\n\npchList1<-c(rep(1,nt_FieldTrees1),rep(2,nt_LiDAR_all1),\n               rep(3,nt_LiDAR_f1.1),rep(4,nt_LiDAR_f2.1))\n\ncorList1<-c(rep(\"black\",nt_FieldTrees1),rep(\"yellow\",nt_LiDAR_all1),\n           rep(\"blue\",nt_LiDAR_f1.1),rep(\"red\",nt_LiDAR_f2.1))\n\nPlot01List1<-cbind(Plot01Class,rbind(FieldTrees1[,c(\"x\",\"y\")],\n                  LiDAR_all1[,c(\"x\",\"y\")],\n                  LiDAR_f1.1[,c(\"x\",\"y\")],\n                  LiDAR_f2.1[,c(\"x\",\"y\")]))\n\nwindows()\npar(mfrow=c(1,2))\n#par(xpd=T, mar=par()$mar+c(5,0,0,0))\nplot(raster(outgrid_stand1),xlim=c(739890,739945), ylim=c(3459690,3459742),xlab=\"UTM Easthing\", ylab=\"UTM Northing\")\n\n\nplot(SpatialPoints(Plot01List1[,2:3]),add=T, col=corList1,pch=pchList1)\ngrid(, lwd = 2)\n\n#legend(locator(1),c(\"group A\", \"group B\"), pch = c(1,2), lty = c(1,2))\n\ntreeBuff1 <- readShapePoly('C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\buffer_FieldTree.shp')\n\n# visualization of the original ResponseV map\nplot(treeBuff1, add=T, border='black', bg='transparent', asp=1)\n\n    #*************************************************************************************************\n#----------------------------------------------------------------------------------------------------------###\n#----------------------------------------------------------------------------------------------------------###\n# 02 clip CHM plot02\n#----------------------------------------------------------------------------------------------------------###\n#----------------------------------------------------------------------------------------------------------###\n\noutgrid = read.asciigrid(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\02_BigPlots\\\\NE\\\\NE_LASplots_15.asc\")\n\n# Packages necessary\nrequire(raster);require(sp);require(maptools);\n# Importing shapefile of the land\n# open the shapefile\nforest.shp <- readShapePoly('C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Gridbuffer\\\\grid50buffer2.shp')\n\n\n# clip the area of the interest\noutgrid_stand <- outgrid[!is.na(overlay(outgrid, forest.shp)),]\n\n\n# save the map \n#writeAsciiGrid(outgrid_stand,\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot02\\\\Plot02_Stand.asc\")\n\n#----------------------------------------------------------------------------------------------------------###\n# 02 - Import shapefile for the Plot01 and plot the tree location\n#----------------------------------------------------------------------------------------------------------###\nFieldTrees<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot02\\\\Field_trees.shp\")\nFieldTrees<-as.data.frame(FieldTrees)\nhead(FieldTrees)\nnt_FieldTrees<-nrow(FieldTrees)\n\nLiDAR_all<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot02\\\\LiDAR_all.shp\")\nLiDAR_all<-as.data.frame(LiDAR_all)\nhead(LiDAR_all)\nnt_LiDAR_all<-nrow(LiDAR_all)\n\nLiDAR_f1<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot02\\\\LiDAR_15_f20.shp\")\nLiDAR_f1<-as.data.frame(LiDAR_f1)\nhead(LiDAR_f1)\nnt_LiDAR_f1<-nrow(LiDAR_f1)\n\nLiDAR_f2<- readShapePoints(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot02\\\\LiDAR_15_f18.shp\")\nLiDAR_f2<-as.data.frame(LiDAR_f2)\nhead(LiDAR_f2)\nnt_LiDAR_f2<-nrow(LiDAR_f2)\n\nPlot01Class<-c(rep(\"Field\",nt_FieldTrees),rep(\"Flight 1-2\",nt_LiDAR_all),\n               rep(\"Flight line 1\",nt_LiDAR_f1),rep(\"Flight line 2\",nt_LiDAR_f2))\n\npchList<-c(rep(1,nt_FieldTrees),rep(2,nt_LiDAR_all),\n           rep(3,nt_LiDAR_f1),rep(4,nt_LiDAR_f2))\n\ncorList<-c(rep(\"black\",nt_FieldTrees),rep(\"yellow\",nt_LiDAR_all),\n           rep(\"blue\",nt_LiDAR_f1),rep(\"red\",nt_LiDAR_f2))\n\nPlot01List<-cbind(Plot01Class,rbind(FieldTrees[,c(\"x\",\"y\")],\n                                    LiDAR_all[,c(\"x\",\"y\")],\n                                    LiDAR_f1[,c(\"x\",\"y\")],\n                                    LiDAR_f2[,c(\"x\",\"y\")]))\n\nwindows()\n#par(xpd=T, mar=par()$mar+c(5,0,0,0))\n#plot(raster(outgrid_stand),xlab=\"UTM Easthing\", ylab=\"UTM Northing\")\nplot(raster(outgrid_stand),xlim=c(748035,748087.5), ylim=c(3459943,3459993),xlab=\"UTM Easthing\", ylab=\"UTM Northing\")\n\n\nplot(SpatialPoints(Plot01List[,2:3]),add=T, col=corList,pch=pchList)\ngrid(, lwd = 2)\n\n#legend(locator(1),c(\"group A\", \"group B\"), pch = c(1,2), lty = c(1,2))\n\ntreeBuff <- readShapePoly('C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\plot02\\\\Field_tree_buff.shp')\n\n# visualization of the original ResponseV map\n#plot(treeBuff, add=T, border='black', bg='transparent', asp=1)\nplot(polybuffs, add=T, border='yellow', bg='transparent', asp=1)\n\n  \n#####################################\n#\n# 3D plot\n#\n###################################\nrequire(rLiDAR)\n??rLiDAR\n\nmyColorRamp <- function(colors, values) {\n  v <- (values - min(values))/diff(range(values))\n  x <- colorRamp(colors)(v)\n  rgb(x[,1], x[,2], x[,3], maxColorValue = 255)\n}\n\nALS1<-readLAS(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot01\\\\GridLASplots_208.las\",short=TRUE)\n\nsummary(ALS1)\n\n# ALS\nhead(ALS)\n\nALScolorpallet <- myColorRamp(c(\"blue\",\"green\",\"yellow\",\"red\"),ALS1[,3])\n\nxrange<-range(ALS1[,1])[1]\nXc<-ALS1[,1]-xrange\n\nyrange<-range(ALS1[,2])[1]\nYc<-ALS1[,2]-yrange\n\nxyz<-cbind(Xc,Yc,ALS1[,3])\n\n# plot 2d\nwindows()\n\nplot3d(xyz, col=ALScolorpallet, axes=FALSE, xlab = \"\", ylab = \"\",zlab = \"\", zlim=range(ALS1[,3]))\naxes3d(c(\"x-\", \"y+\",\"z\"), col=\"black\")\nplanes3d(a=0,b=0,c=-1,d=0.0001,color=\"gray\",alpha=1)\ngrid3d(side=c('x-', 'y+', 'z'))\ntitle3d(xlab = \"\", ylab = \"\",zlab = \"Height\", col=\"black\")\naspect3d(1,1,0.7)\n\n# Plotting the stand\n\nxtg<-range(FieldTrees[,1])[1]\nXTc<-FieldTrees[,1]-xtg\n\nytg<-range(FieldTrees[,2])[1]\nYTc<-FieldTrees[,2]-ytg\n\ncrPoly<- 3.75105 - 0.17919*FieldTrees[,17] + 0.01241*(FieldTrees[,17]^2)\n\nfor( i in 1:nrow(FieldTrees)){\n  LiDARtrees3D(crownshape = \"halfellipsoid\", CL = FieldTrees[1,17]*0.6, CW = crPoly[i],#CW = FieldTrees[i,21]*2,\n               HCB =  (FieldTrees[i,17])*0.4, X = XTc[i], Y = YTc[i], dbh = 0.4,\n               crowncolor = \"forestgreen\", stemcolor = \"chocolate4\",\n               resolution=\"high\", mesh=TRUE)\n}\n\nrequire(rLiDAR)\n\n\nALS2<-readLAS(\"C:\\\\00_CFJ_paper\\\\01_Processing\\\\07_plotClipFigure\\\\Plot02\\\\GridLASplots_209.las\",short=TRUE)\n\nsummary(ALS2)\n\n# ALS\nhead(ALS2)\n\nALScolorpallet <- myColorRamp(c(\"blue\",\"green\",\"yellow\",\"red\"),ALS2[,3])\n\nxrange<-range(ALS2[,1])[1]\nXc<-ALS2[,1]-xrange\n\nyrange<-range(ALS2[,2])[1]\nYc<-ALS2[,2]-yrange\n\nxyz<-cbind(Xc,Yc,ALS2[,3])\n\n# plot 2d\nwindows()\nopen3d()\nplot3d(xyz, col=ALScolorpallet, axes=FALSE, xlab = \"\", ylab = \"\",zlab = \"\", zlim=range(ALS1[,3]))\naxes3d(c(\"x-\", \"y+\",\"z\"), col=\"black\")\naxes3d(c(\"x-\",\"x+\", \"y+\",\"y-\"), col=\"black\")\n\nplanes3d(a=0,b=0,c=-1,d=0.0001,color=\"gray\",alpha=1)\ngrid3d(side=c('x-', 'y+', 'z-'))\ngrid3d(side=c('z-'),lwd=2, col=\"black\")\n\ntitle3d(xlab = \"\", ylab = \"\",zlab = \"Height\", col=\"black\")\naspect3d(1,1,0.7)\n\n# Plotting the stand\n\nxtg<-range(FieldTrees[,1])[1]\nXTc<-FieldTrees[,1]-xtg\n\nytg<-range(FieldTrees[,2])[1]\nYTc<-FieldTrees[,2]-ytg\n\nfor( i in 1:nrow(FieldTrees)){\n  LiDARtrees3D(crownshape = \"halfellipsoid\", CL = FieldTrees[1,17]*0.6, CW = FieldTrees[i,21]*2,\n               HCB =  (FieldTrees[i,17])*0.4, X = XTc[i], Y = YTc[i], dbh = 0.4,\n               crowncolor = \"forestgreen\", stemcolor = \"chocolate4\",\n               resolution=\"high\", mesh=T)\n}\n\nrequire(rLiDAR)\n\ncrPoly<- 3.75105 - 0.17919*LiDAR_all[,6] + 0.01241*(LiDAR_all[,6]^2)\ncrPoly<- 2.51503 + 0.00901*LiDAR_all[,6]\ncrPoly<-crPoly/2\npolys<-list() \n \n\nfor(i in 1:length(FieldTrees[,1])) { \n  discbuff<-disc(radius=crPoly[i], centre=c(FieldTrees[i,1], FieldTrees[i,2])) \n  discpoly<-Polygon(rbind(cbind(discbuff$bdry[[1]]$x, \n                                y=discbuff$bdry[[1]]$y), c(discbuff$bdry[[1]]$x[1], \n                                                           y=discbuff$bdry[[1]]$y[1]))) \n  polys<-c(polys, discpoly) \n} \n\nspolys<-list() \nfor(i in 1:length(polys)) { \n  spolybuff<-Polygons(list(polys[[i]]), ID=row.names(FieldTrees)[i]) \n  spolys<-c(spolys, spolybuff) \n} \npolybuffs<-SpatialPolygons(spolys) \nplot(polybuffs)\n",
    "created" : 1421881719638.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3294532683",
    "id" : "50C0B86B",
    "lastKnownWriteTime" : 1424248713,
    "path" : "C:/00_CFJ_paper/00_Scripts/10_plot_figure2d_3d.r",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}